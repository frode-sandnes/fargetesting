<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSL Fargetrening</title>
    <style>
        :root {
            --background-color: #121212;
            --text-color: #e0e0e0;
            --container-bg: #1e1e1e;
            --border-color: #333;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            --modal-bg: #2a2a2a;
            --button-bg: #007bff;
            --button-hover-bg: #0056b3;
            --correct-color: #5cb85c;
            --incorrect-color: #d9534f;
            --group-bg: #2a2a2a;
        }

        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        #app-container {
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 1000px;
            box-sizing: border-box;
            text-align: center;
        }

        h1, h2 {
            color: var(--text-color);
        }
        
        #color-comparison-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 50px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .color-display-box {
            width: 200px;
            height: 200px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .color-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-color);
            font-size: 14px;
            white-space: nowrap;
        }

        #radio-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        #radio-group-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 20px;
            width: 100%;
            flex-wrap: wrap;
        }

        .radio-group {
            flex: 1;
            min-width: 250px;
            text-align: left;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            background-color: var(--group-bg);
        }

        .radio-group h3 {
            margin: 0 0 10px 0;
            color: var(--text-color);
            text-align: center;
        }

        .radio-group label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 15px;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
        }

        #status-section {
            margin-top: 20px;
        }

        #progress {
            font-size: 18px;
            color: var(--text-color);
        }
        
        #submit-button {
            padding: 12px 25px;
            font-size: 16px;
            color: white;
            background-color: var(--button-bg);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }

        #submit-button:hover {
            background-color: var(--button-hover-bg);
        }

        #results-container {
            display: none;
            margin-top: 30px;
            width: 100%;
        }

        #results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        #results-table th, #results-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        #results-table th {
            background-color: #2a2a2a;
            font-weight: bold;
        }
        
        #results-table .correct-answer { color: var(--correct-color); }
        #results-table .incorrect-answer { color: var(--incorrect-color); }
        
        .color-sample {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: inline-block;
            vertical-align: middle;
            margin-left: 5px;
        }

        #summary {
            margin-top: 20px;
            font-size: 16px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }

        .modal-content {
            background-color: var(--modal-bg);
            color: var(--text-color);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
            text-align: center;
        }
        
        #modal-message .color-comparison {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        #modal-message .color-label {
            text-align: center;
            font-size: 14px;
            margin-top: 5px;
        }

        .modal-content h3 {
            margin-top: 0;
        }

        .modal-content p {
            font-size: 16px;
        }

        .modal-content button {
            padding: 10px 20px;
            margin-top: 15px;
            cursor: pointer;
            color: white;
            background-color: var(--button-bg);
            border: none;
            border-radius: 5px;
        }

        .modal-content button:hover {
            background-color: var(--button-hover-bg);
        }
        
        .parameter-diff {
            display: block;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .parameter-diff.correct { color: var(--correct-color); }
        .parameter-diff.incorrect { color: var(--incorrect-color); }

    </style>
</head>
<body>

<div id="app-container">
    <div id="training-interface">
        <h1>HSL Fargetrening ðŸŽ¨</h1>
        <p>Velg ordene som best beskriver fargen du ser.</p>

        <div id="color-comparison-container">
            <div id="target-color-box" class="color-display-box">
                <span class="color-label">MÃ¥lfarge</span>
            </div>
            <div id="student-color-box" class="color-display-box">
                <span class="color-label">Din valgte farge</span>
            </div>
        </div>

        <div id="radio-section">
            <div id="radio-group-container">
                <div class="radio-group" id="hue-group">
                    <h3>Fargenyanse (Hue)</h3>
                </div>
                <div class="radio-group" id="saturation-group">
                    <h3>Metning (Saturation)</h3>
                </div>
                <div class="radio-group" id="lightness-group">
                    <h3>Lyshet (Lightness)</h3>
                </div>
            </div>
        </div>

        <div id="status-section">
            <p id="progress">Fargetest 1 av 5</p>
            <button id="submit-button">Sjekk svar</button>
        </div>
    </div>

    <div id="results-container">
        <h2>Resultater</h2>
        <p>Gratulerer, du har fullfÃ¸rt treningen! Her er resultatene dine:</p>
        <table id="results-table">
            <thead>
                <tr>
                    <th>Test</th>
                    <th>Resultat</th>
                    <th>Tid (s)</th>
                    <th>Justeringer</th>
                    <th>Dine svar</th>
                    <th>Riktige svar</th>
                    <th>Farge</th>
                    <th>Ditt svar</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td colspan="2">Gjennomsnitt</td>
                    <td id="avg-time"></td>
                    <td id="avg-adjustments"></td>
                    <td colspan="4"></td>
                </tr>
            </tfoot>
        </table>
        <div id="summary">
            <p>Total suksessrate: <span id="success-rate"></span></p>
        </div>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title"></h3>
        <div id="modal-message"></div>
        <button id="modal-next-button">Neste farge</button>
    </div>
</div>

<script>
    // --- HSL Color Model Utilities ---
    const hslToRgb = (h, s, l) => {
        h /= 360;
        s /= 100;
        l /= 100;

        let r, g, b;

        if (s === 0 || l === 0 || l === 1) {
            r = g = b = l; // achromatic
        } else {
            const hue2rgb = (p, q, t) => {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
    };
    
    // Mapping of Norwegian natural language keywords to HSL values
    const HSL_KEYWORDS = {
        hue: {
            "rÃ¸d": 0, "rÃ¸doransje": 30, "oransje": 45, "guloransje": 60, "gul": 90, "gulgrÃ¸nn": 120,
            "grÃ¸nn": 150, "turkis": 180, "blÃ¥grÃ¸nn": 210, "blÃ¥": 240, "blÃ¥lilla": 270, "lilla": 300,
            "rÃ¸dlilla": 330
        },
        saturation: {
            "umettet": 0, "veldig lite mettet": 20, "litt mettet": 40, "middels mettet": 60, "hÃ¸yt mettet": 80, "fullt mettet": 100
        },
        lightness: {
            "ingen lyshet": 0, "veldig mÃ¸rk": 20, "mÃ¸rk": 35, "middels mÃ¸rk": 50, "middels lys": 65, "lys": 80, "full lyshet": 100
        }
    };
    
    // Reverse mapping for converting HSL values back to keywords
    const HSL_VALUES_TO_KEYWORDS = {
        hue: Object.fromEntries(Object.entries(HSL_KEYWORDS.hue).map(([k, v]) => [v, k])),
        saturation: Object.fromEntries(Object.entries(HSL_KEYWORDS.saturation).map(([k, v]) => [v, k])),
        lightness: Object.fromEntries(Object.entries(HSL_KEYWORDS.lightness).map(([k, v]) => [v, k])),
    };

    // --- DOM Elements and State Variables ---
    const targetColorBox = document.getElementById('target-color-box');
    const studentColorBox = document.getElementById('student-color-box');
    const hueGroup = document.getElementById('hue-group');
    const saturationGroup = document.getElementById('saturation-group');
    const lightnessGroup = document.getElementById('lightness-group');
    const progressSpan = document.getElementById('progress');
    const submitButton = document.getElementById('submit-button');
    const trainingInterface = document.getElementById('training-interface');
    const resultsContainer = document.getElementById('results-container');
    const resultsTableBody = document.querySelector('#results-table tbody');
    const avgTimeSpan = document.getElementById('avg-time');
    const avgAdjustmentsSpan = document.getElementById('avg-adjustments');
    const successRateSpan = document.getElementById('success-rate');
    const modal = document.getElementById('resultModal');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalNextButton = document.getElementById('modal-next-button');

    let currentTestIndex = 0;
    const numTests = 5;
    let testColors = [];
    let currentTestColor = null;
    let startTime = 0;
    let adjustments = 0;
    let testResults = [];
    
    // --- Main Logic ---
    const generateTestColors = () => {
        testColors = [];
        const h_keys = Object.values(HSL_KEYWORDS.hue);
        const s_keys = Object.values(HSL_KEYWORDS.saturation);
        const l_keys = Object.values(HSL_KEYWORDS.lightness);

        for (let i = 0; i < numTests; i++) {
            const h = h_keys[Math.floor(Math.random() * h_keys.length)];
            const s = s_keys[Math.floor(Math.random() * s_keys.length)];
            const l = l_keys[Math.floor(Math.random() * l_keys.length)];
            
            // Exclude pure white, black, or gray
            if (s === 0 || l === 0 || l === 100) {
                 i--; // Regenerate if it's a gray, white, or black
                 continue;
            }
            testColors.push([h, s, l]);
        }
    };

    const startTest = () => {
        if (currentTestIndex >= numTests) {
            showResults();
            return;
        }

        currentTestColor = testColors[currentTestIndex];
        const [h, s, l] = currentTestColor;
        const [r, g, b] = hslToRgb(h, s, l);
        targetColorBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

        // Reset radio buttons
        document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
        studentColorBox.style.backgroundColor = 'transparent';
        
        adjustments = 0;
        startTime = Date.now();
        progressSpan.textContent = `Fargetest ${currentTestIndex + 1} av ${numTests}`;
    };

    const populateRadioButtons = () => {
        const createRadioButtons = (group, name, keywords) => {
            group.innerHTML = `<h3>${name}</h3>`;
            for (const key in keywords) {
                const id = `${name.toLowerCase()}-${key.replace(/\s/g, '-')}`;
                group.innerHTML += `
                    <label for="${id}">
                        <input type="radio" id="${id}" name="${name.toLowerCase()}" value="${key}">
                        ${key}
                    </label>
                `;
            }
        };

        createRadioButtons(hueGroup, "Fargenyanse", HSL_KEYWORDS.hue);
        createRadioButtons(saturationGroup, "Metning", HSL_KEYWORDS.saturation);
        createRadioButtons(lightnessGroup, "Lyshet", HSL_KEYWORDS.lightness);

        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', updateStudentColor);
        });
    };
    
    const updateStudentColor = () => {
        adjustments++;
        const selectedHue = document.querySelector('input[name="fargenyanse"]:checked')?.value;
        const selectedSaturation = document.querySelector('input[name="metning"]:checked')?.value;
        const selectedLightness = document.querySelector('input[name="lyshet"]:checked')?.value;

        if (selectedHue && selectedSaturation && selectedLightness) {
            const h = HSL_KEYWORDS.hue[selectedHue];
            const s = HSL_KEYWORDS.saturation[selectedSaturation];
            const l = HSL_KEYWORDS.lightness[selectedLightness];
            const [r, g, b] = hslToRgb(h, s, l);
            studentColorBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
        } else {
            studentColorBox.style.backgroundColor = 'transparent';
        }
    };
    
    // Calculates a simple "score" based on how many parameters are incorrect
    const calculateScore = (studentAnswer, correctAnswers) => {
        let score = 0;
        let feedback = "";
        
        const hueCorrect = studentAnswer.hue === correctAnswers.hue;
        const satCorrect = studentAnswer.saturation === correctAnswers.saturation;
        const lightCorrect = studentAnswer.lightness === correctAnswers.lightness;

        if (!hueCorrect) {
            feedback += `<span class="parameter-diff incorrect">Fargenyanse: feil svar. Riktig svar er '${correctAnswers.hue}'.</span>`;
            score++;
        }
        
        if (!satCorrect) {
            feedback += `<span class="parameter-diff incorrect">Metning: feil svar. Riktig svar er '${correctAnswers.saturation}'.</span>`;
            score++;
        }
        
        if (!lightCorrect) {
            feedback += `<span class="parameter-diff incorrect">Lyshet: feil svar. Riktig svar er '${correctAnswers.lightness}'.</span>`;
            score++;
        }
        
        return { score, feedback };
    };

    const submitAnswer = () => {
        const selectedHue = document.querySelector('input[name="fargenyanse"]:checked')?.value;
        const selectedSaturation = document.querySelector('input[name="metning"]:checked')?.value;
        const selectedLightness = document.querySelector('input[name="lyshet"]:checked')?.value;

        if (!selectedHue || !selectedSaturation || !selectedLightness) {
            alert('Vennligst velg en beskrivelse for hver komponent.');
            return;
        }

        const studentAnswer = {
            hue: selectedHue,
            saturation: selectedSaturation,
            lightness: selectedLightness
        };

        const [h, s, l] = currentTestColor;
        const correctAnswers = {
            hue: HSL_VALUES_TO_KEYWORDS.hue[h],
            saturation: HSL_VALUES_TO_KEYWORDS.saturation[s],
            lightness: HSL_VALUES_TO_KEYWORDS.lightness[l]
        };

        const isCorrect = (studentAnswer.hue === correctAnswers.hue) &&
                          (studentAnswer.saturation === correctAnswers.saturation) &&
                          (studentAnswer.lightness === correctAnswers.lightness);
        
        // Get student's selected color for display in results table and modal
        const studentHSL = [HSL_KEYWORDS.hue[selectedHue], HSL_KEYWORDS.saturation[selectedSaturation], HSL_KEYWORDS.lightness[selectedLightness]];
        const studentRGB = hslToRgb(...studentHSL);
        const testRGB = hslToRgb(...currentTestColor);
        const finalTime = ((Date.now() - startTime) / 1000).toFixed(1);
        
        const { score, feedback } = calculateScore(studentAnswer, correctAnswers);

        if (isCorrect) {
            modalTitle.textContent = "Riktig! ðŸŽ‰";
            modalMessage.innerHTML = `<p>Utmerket! Du har beskrevet fargen korrekt.</p>`;
        } else {
            modalTitle.textContent = "Feil ðŸ˜ž";
            modalMessage.innerHTML = `
                <p>Din beskrivelse var ikke helt riktig.</p>
                <p>Din score: <strong>${score} av 3 feil</strong>.</p>
                ${feedback}
            `;
        }
        
        // Add color comparison to the modal
        modalMessage.innerHTML += `
            <div class="color-comparison">
                <div>
                    <div class="color-sample" style="background-color: ${`rgb(${testRGB.join(',')})`}; width: 60px; height: 60px;"></div>
                    <div class="color-label">Riktig farge</div>
                </div>
                <div>
                    <div class="color-sample" style="background-color: ${`rgb(${studentRGB.join(',')})`}; width: 60px; height: 60px;"></div>
                    <div class="color-label">Ditt svar</div>
                </div>
            </div>
            <p>Riktig svar: <strong>${correctAnswers.lightness} ${correctAnswers.saturation} ${correctAnswers.hue}</strong>.</p>
            <p>Ditt svar: <strong>${studentAnswer.lightness} ${studentAnswer.saturation} ${studentAnswer.hue}</strong>.</p>
        `;

        testResults.push({
            correct: isCorrect,
            time: finalTime,
            adjustments: adjustments,
            studentAnswer: studentAnswer,
            correctAnswer: correctAnswers,
            testColorRGB: `rgb(${testRGB.join(',')})`,
            studentColorRGB: `rgb(${studentRGB.join(',')})`
        });

        modal.style.display = 'block';
    };

    const nextTest = () => {
        modal.style.display = 'none';
        currentTestIndex++;
        if (currentTestIndex < numTests) {
            startTest();
        } else {
            showResults();
        }
    };

    const showResults = () => {
        trainingInterface.style.display = 'none';
        resultsContainer.style.display = 'block';

        resultsTableBody.innerHTML = '';
        let totalTime = 0;
        let totalAdjustments = 0;
        let successfulTests = 0;

        testResults.forEach((result, index) => {
            const row = resultsTableBody.insertRow();
            const correctTextClass = result.correct ? 'correct-answer' : 'incorrect-answer';
            const studentAnsText = `${result.studentAnswer.lightness}, ${result.studentAnswer.saturation}, ${result.studentAnswer.hue}`;
            const correctAnsText = `${result.correctAnswer.lightness}, ${result.correctAnswer.saturation}, ${result.correctAnswer.hue}`;
            
            row.innerHTML = `
                <td>${index + 1}</td>
                <td class="${correctTextClass}">${result.correct ? 'Riktig' : 'Feil'}</td>
                <td>${result.time}</td>
                <td>${result.adjustments}</td>
                <td>${studentAnsText}</td>
                <td>${correctAnsText}</td>
                <td><div class="color-sample" style="background-color: ${result.testColorRGB};"></div></td>
                <td><div class="color-sample" style="background-color: ${result.studentColorRGB};"></div></td>
            `;
            totalTime += parseFloat(result.time);
            totalAdjustments += result.adjustments;
            if (result.correct) {
                successfulTests++;
            }
        });

        avgTimeSpan.textContent = (totalTime / numTests).toFixed(1);
        avgAdjustmentsSpan.textContent = (totalAdjustments / numTests).toFixed(1);
        successRateSpan.textContent = `${((successfulTests / numTests) * 100).toFixed(0)}%`;
    };

    // --- Event Listeners ---
    submitButton.addEventListener('click', submitAnswer);
    modalNextButton.addEventListener('click', nextTest);

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    
    // --- Initial Setup ---
    window.onload = () => {
        populateRadioButtons();
        generateTestColors();
        startTest();
    };
</script>

</body>
</html>